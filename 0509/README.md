# 5월 9일 수업내용

## 파일 시스템 구조

- **부트 블록**: 파일 시스템의 시작 지점, 부트스트랩 코드 저장
- **슈퍼 블록**: 전체 파일 시스템 정보 (블록 수, i-노드 수 등)
- **i-리스트**: 파일들을 대표하는 i-노드들의 리스트 (한 블록당 약 40개)
- **데이터 블록**: 실제 파일의 내용을 저장

## i-노드 (i-Node)

- 파일당 하나 존재하며, 파일의 메타데이터 저장
  - 파일 타입, 크기, 권한, 소유자, 접근/수정 시간, 데이터 블록 주소 등 포함

## 블록 포인터

- i-노드가 가리키는 데이터 블록 주소
  - 직접 포인터(10개), 간접 포인터(1개), 이중 간접 포인터(1개)로 구성

## 파일 입출력 구현

- **파일 디스크립터 배열 (Fd Array)**: 각 프로세스마다 존재
- **열린 파일 테이블 (Open File Table)**: 시스템 전체에서 열려있는 파일의 정보 관리
- **동적 i-노드 테이블**: 열린 파일의 i-노드 정보를 저장하는 커널 자료구조

## 파일 상태 (File Status)

- `stat()`, `fstat()`, `lstat()` 함수로 파일의 상태 정보를 조회
- **stat 구조체 필드**:
  - 파일 타입/권한, i-노드 번호, 링크 수, 소유자/그룹 ID, 파일 크기, 접근/수정/변경 시간 등

## 파일 타입

- 일반파일, 디렉터리, 문자/블록 장치, FIFO, 소켓, 심볼릭 링크
- 검사 매크로: `S_ISREG`, `S_ISDIR`, `S_ISCHR`, `S_ISBLK`, `S_ISFIFO`, `S_ISSOCK`, `S_ISLNK`

## 파일 권한

- **세 그룹**: 소유자(owner), 그룹(group), 기타 사용자(others)
- **권한 비트**: 읽기(r), 쓰기(w), 실행(x)
- **파일 접근 마스크**: `st_mode` 값의 하위 9비트
- **변경 함수**:
  - `chmod()`, `fchmod()` → 파일의 권한 변경
  - `chown()`, `lchown()`, `fchown()` → 파일의 사용자 및 그룹 변경

## utime()

- 파일의 최종 접근 시간(`actime`)과 변경 시간(`modtime`)을 수정
- `utime()` 함수 사용, `struct utimbuf` 구조체로 시간 지정

## 디렉터리 구현

- 디렉터리도 i-노드를 가지며, 내부는 **디렉터리 엔트리(파일 이름 + i-노드 번호)** 목록
- **opendir(), readdir(), closedir()** 함수로 디렉터리 순회

## list1.c & list2.c

- **list1.c**: 디렉터리 내 파일 이름 출력
- **list2.c**: `ls -l` 명령처럼 파일 상태 정보, 권한, 타입, 소유자, 크기, 수정 시간 출력
  - `printStat()`, `type()`, `perm()` 함수로 구현

## 디렉터리 생성 및 삭제

- **mkdir()**: 디렉터리 생성 (`"."`, `".."` 자동 생성)
- **rmdir()**: 디렉터리 삭제 (비어 있어야 함)

## 링크

- **하드 링크**: 기존 파일의 또 다른 이름, 같은 파일 시스템 내에서만 가능
- **심볼릭 링크**: 실제 파일 경로명을 저장한 간접 포인터, 다른 파일 시스템에도 가능
- 생성: `link()`, `symlink()`
- 삭제: `unlink()`
- 확인: `readlink()`

## 핵심 개념 요약

- 파일 시스템은 부트블록, 슈퍼블록, i-리스트, 데이터블록으로 구성
- 파일 입출력은 fd 배열, 열린 파일 테이블, 동적 i-노드 테이블로 커널에서 관리
- 모든 파일은 i-노드를 통해 메타정보와 데이터 블록 주소를 관리
- 디렉터리는 파일 목록을 담는 특수한 파일이며 i-노드로 구현
- 링크는 기존 파일의 별칭을 만들어주는 기능으로 하드/소프트 두 가지 방식 존재
